#!/bin/bash

# include $www index.html script.js style.css

set -e

main() {
  local where="$1"
  local sink="$2"
  shift 2

  local replacements=()
  while [[ $1 ]]; do
    local src="$1"

    local sum; sum="$( md5sum "$src" | cut -c 1-10 )"
    local name="${src%.*}"
    local ext="${src##*.}"
    local out="$name-$sum.$ext"
    cp "$src" "$where"/"$out"

    replacements+=( -e "s/$src/$out/g" )
    shift
  done

  sed "${replacements[@]}" < "$sink" > "$where"/"$sink"
}

main "$@"
